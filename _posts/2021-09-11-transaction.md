---
title: "Transaction"
excerpt: "데이터베이스의 트랜잭션에 대해 알아보자"

categories:
  - Database
tags:
  - [databse, transaction]

toc: true
toc_sticky: true

date: 2021-09-11
last_modified_at: 2021-09-11
---

## 트랜잭션이란?

**데이터 베이스의 상태를 변경하는 하나의 논리적 기능을 수행하기 위한 작업의 단위**입니다. 쉽게 말해 한꺼번에 수행되어야 할 연산을 모아놓은 것이라고 할 수 있습니다. 데이터 베이스는 항상 정확하고 일관된 데이터를 유지해야하는데 트랜잭션은 이러한 성질을 유지할 수 있게 도와주는 역할을 합니다.

트랜잭션은 DB 서버에 여러 개의 클라이언트가 동시에 액세스 하거나 응용프로그램이 갱신을 처리하는 과정에서 중단될 수 있는 경우 등 데이터 부정합을 방지하고자 할 때 사용합니다. 부정합이 발생하지 않으려면 프로세스를 병렬로 처리하지 않도록 하여 한 번에 하나의 프로세스만 처리하도록 하면 되는데, 이는 효율이 너무 떨어집니다. 즉, 병렬로 처리할 수 밖에 없는 현실적인 상황으로 인해 부정합을 방지하고자 트랜잭션을 사용하는 것입니다.

트랜잭션의 중요성은 금융 소프트웨어에서 두드러지게 나타납니다. 예를 들어 A가 B에게 100만원을 송금한다고 합시다. 이러한 작업은 다음과 같은 순서로 이루어 집니다.

1. A의 계좌에서 100만원을 뺀다.
2. B의 계좌에 100만원을 더한다.

이때 1번 작업이 완료된 후 2번작업이 시작되기 전에 오류가 발생하여 시스템이 멈추게 된다면 100만원이 증발해버리는 일이 발생합니다. 따라서 이러한 작업을 수행할때는 1,2번 작업을 트랜잭션으로 묶어서 한번에 1,2번 작업이 처리되거나 오류가 발생하면 진행했던 모든 작업을 되돌려야 합니다.

## 트랜잭션의 특성

트랜잭션이 성공적으로 처리되어 데이터베이스의 무결성과 일관성을 보장하려면 4가지 특성을 만족해야 합니다. 트랜잭션의 특성을 흔히 ACID라고 합니다.

- **Atomicity (원자성)**
- **Consistency (일관성)**
- **Isolation (격리성)**
- **Durability (지속성)**

1. **Atomic (원자성)**
   - 트랜잭션을 구성하는 연산들은 데이터베이스에 모두 반영되거나 반영되지 않아야함을 의미.(all or nothing)
   - 트랜잭션 수행과정에서 오류가 발생하여 작업이 완료되지 못하면 트랜잭션 시작전 상태로 데이터베이스를 되돌려야 함.
2. **Consistency (일관성)**
   - 트랜잭션이 성공적으로 수행된 후에도 데이터베이스가 일관성 있는 상태를 유지해야함을 의미
   - 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 함.
   - 데이터베이스의 제약조건을 위배하는 작업을 트랜잭션과정에서 수행할 수 없음을 나타냄
   - 예시: 송금 예제에서 금액의 데이터 타입을 정수형(integer)에서 문자열(string)로 변경할 수 없음
3. **Isolation (격리성)**
   - 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 현재 수행중인 트랜잭션 실행 도중 다른 트랜잭션의 연산이 끼어들 수 없음을 의미
   - 예시: A->B로 송금 과정에서 다른 트랜잭션이 B에게로 송금할 수 없음
4. **Durability (지속성)**
   - 트랜잭션이 성공적으로 완료된 이후 데이터베이스에 반영한 수행 결과는 손실되지 않고 영구적으로 유지되어야 함을 의미

- +추가: ACID는 이론적으로 트랜잭션이 보장해야할 특성입니다. 실제로는 모든 규칙을 지킬 경우 성능상 속도 저하가 생길 수 있어 트랜잭션 격리 수준을 조정합니다.

# 트랜잭션의 연산

1. **commit 연산**

- **트랜잭션이 성공적으로 수행되었음을 선언하는 연산**
- commit 연산의 실행을 통해 트랜잭션의 수행이 성공적으로 완료되었음을 선언하고 결과를 최종 데이터베이스에 반영.

2. **rollback 연산**

- **트랜잭션이 수행을 실패했음을 선언하고 작업울 취소하는 연산**
- 트랜잭션 수행되는 도중 일부 연산이 처리되지 못한 상황에서는 rollback 연산을 실행하여 트랜잭션의 수행이 실패했음을 선언하고, 데이터베이스를 트랜잭션 수행 전의 일관된 상태로 되돌려야 함.

# 트랜잭션의 상태

![image](https://itwiki.kr/images/1/1e/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98_%EC%83%81%ED%83%9C%EC%A0%84%EC%9D%B4%EB%8F%84.png)

- 활동 상태
  - 트랜잭션이 수행을 시작하여 현재 수행 중인 상태.
- 부분 완료 상태
  - 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
- 완료 상태
  - 트랜잭션이 성공적으로 완료되어 commit 연산을 실행한 완료 상태.
- 실패 상태
  - 장애가 발생하여 트랜잭션의 수행이 중단된 상태.
- 철회 상태
  - 수행이 실패하여 rollback 연산을 실행한 상태.
